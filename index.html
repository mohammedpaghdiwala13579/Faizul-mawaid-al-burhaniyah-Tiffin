<!DOCTYPE html>
<html lang="en">
<head>
    <!-- (all your existing <head> content unchanged) -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Tiffin Service - Weekly Menu (Google Sheets Integrated)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* (all your existing CSS unchanged – omitted here for brevity) */
        /* ... your beautiful styles ... */
    </style>
</head>
<body>
    <!-- (all your existing HTML unchanged) -->
    <div class="container">
        <!-- ... header, tabs, etc. ... -->
    </div>

    <!-- Loading & Toast -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Submitting your order...</div>
    </div>
    <div id="toast" class="toast">Order Delivered</div>

    <!-- WEEKLY MENU DATA & SCRIPT -->
    <script>
        const weeklyMenu = {
            /* (your menu data – unchanged) */
            monday: { /* ... */ },
            tuesday: { /* ... */ },
            wednesday: { /* ... */ },
            thursday: { /* ... */ },
            friday: { /* ... */ },
            saturday: { /* ... */ },
            sunday: { /* ... */ }
        };

        const contentArea = document.querySelector('.content-area');

        function initMenu() {
            /* (unchanged – creates all days, sections, etc.) */
            Object.keys(weeklyMenu).forEach(day => {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'day-content';
                dayDiv.id = day;
                if (day === 'monday') dayDiv.classList.add('active');
                const title = document.createElement('h2');
                title.className = 'day-title';
                title.textContent = `${day.charAt(0).toUpperCase() + day.slice(1)}'s Special`;
                dayDiv.appendChild(title);

                const summary = document.createElement('div');
                summary.className = 'order-summary';
                summary.innerHTML = `
                    <div class="summary-header"><span>Order Summary</span><span>${day.charAt(0).toUpperCase() + day.slice(1)}</span></div>
                    <div class="summary-items" id="${day}-summary"></div>
                `;
                dayDiv.appendChild(summary);

                const submitBtn = document.createElement('button');
                submitBtn.className = 'submit-btn';
                submitBtn.dataset.day = day;
                submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Submit';
                dayDiv.appendChild(submitBtn);

                if (weeklyMenu[day].lunch?.length > 0) {
                    dayDiv.insertBefore(createMealSection('lunch', weeklyMenu[day].lunch), summary);
                }
                if (weeklyMenu[day].dinner?.length > 0) {
                    dayDiv.insertBefore(createMealSection('dinner', weeklyMenu[day].dinner), summary);
                }
                contentArea.appendChild(dayDiv);
            });

            attachAllEventListeners();
            updateSummary('monday');
        }

        function createMealSection(type, items) {
            /* (unchanged – creates lunch/dinner sections) */
            const section = document.createElement('div');
            section.className = `meal-section ${type}`;
            const video = document.createElement('video');
            video.autoplay = video.loop = video.muted = video.playsInline = true;
            const source = document.createElement('source');
            source.src = type === 'lunch'
                ? 'https://assets.mixkit.co/videos/preview/mixkit-sunrise-in-nature-1121-large.mp4'
                : 'https://assets.mixkit.co/videos/preview/mixkit-full-moon-night-sky-3276-large.mp4';
            source.type = 'video/mp4';
            video.appendChild(source);
            section.appendChild(video);

            const header = document.createElement('div');
            header.className = `meal-header ${type}`;
            header.innerHTML = `<i class="fas fa-${type === 'lunch' ? 'sun' : 'moon'}"></i><span>${type.toUpperCase()}</span>`;
            section.appendChild(header);

            const container = document.createElement('div');
            container.className = 'dishes-container';

            const categories = {};
            items.forEach(item => {
                if (!categories[item.cat]) categories[item.cat] = [];
                categories[item.cat].push(item);
            });

            Object.keys(categories).forEach(cat => {
                const catDiv = document.createElement('div');
                catDiv.className = 'dish-category';
                const catTitle = document.createElement('div');
                catTitle.className = 'category-title';
                catTitle.textContent = cat;
                catDiv.appendChild(catTitle);

                categories[cat].forEach(item => {
                    const dish = document.createElement('div');
                    dish.className = 'dish-item';
                    dish.dataset.dish = item.name;
                    dish.innerHTML = `
                        <div class="dish-info">
                            <div class="dish-icon"><i class="fas fa-${item.icon}"></i></div>
                            <div class="dish-name">${item.name}</div>
                        </div>
                        <div class="quantity-selector">
                            <button class="qty-btn minus" type="button">−</button>
                            <div class="qty-display">0</div>
                            <button class="qty-btn plus" type="button">+</button>
                        </div>
                    `;
                    catDiv.appendChild(dish);
                });
                container.appendChild(catDiv);
            });
            section.appendChild(container);
            return section;
        }

        function attachAllEventListeners() {
            // Day tabs (unchanged)
            document.querySelectorAll('.day-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.day-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.day-content').forEach(c => c.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.day).classList.add('active');
                    updateSummary(tab.dataset.day);
                });
            });

            // *** CHANGED: increment/decrement step from 0.5 → 0.25 ***
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('qty-btn')) {
                    const display = e.target.parentElement.querySelector('.qty-display');
                    let val = parseFloat(display.textContent) || 0;

                    if (e.target.classList.contains('plus'))  val += 0.25;
                    if (e.target.classList.contains('minus') && val >= 0.25) val -= 0.25;

                    // Prevent negative values
                    if (val < 0) val = 0;

                    // Show only necessary decimals (0 → 0.25 → 0.5 → 0.75 → 1 → 1.25 …)
                    display.textContent = (val % 1 === 0) ? val : val.toFixed(2).replace(/\.?0+$/, '');

                    const activeDay = document.querySelector('.day-tab.active').dataset.day;
                    updateSummary(activeDay);
                }
            });

            // Submit buttons (unchanged)
            document.addEventListener('click', async function(e) {
                if (e.target.closest('.submit-btn')) {
                    const btn = e.target.closest('.submit-btn');
                    const day = btn.dataset.day;
                    await submitOrder(day);
                }
            });
        }

        function updateSummary(day) {
            const summary = document.getElementById(day + '-summary');
            if (!summary) return;
            summary.innerHTML = '';

            const dayContent = document.getElementById(day);
            const lunch = [], dinner = [];

            dayContent.querySelectorAll('.meal-section.lunch .dish-item').forEach(item => {
                const qty = parseFloat(item.querySelector('.qty-display').textContent) || 0;
                if (qty > 0) lunch.push({name: item.querySelector('.dish-name').textContent.trim(), qty});
            });
            dayContent.querySelectorAll('.meal-section.dinner .dish-item').forEach(item => {
                const qty = parseFloat(item.querySelector('.qty-display').textContent) || 0;
                if (qty > 0) dinner.push({name: item.querySelector('.dish-name').textContent.trim(), qty});
            });

            const addSection = (title, items) => {
                if (items.length === 0) return;
                const h = document.createElement('div'); 
                h.className = 'summary-section-header'; 
                h.textContent = title; 
                summary.appendChild(h);
                items.forEach(i => {
                    const div = document.createElement('div'); 
                    div.className = 'summary-item';
                    const qtyStr = (i.qty % 1 === 0) ? i.qty : i.qty.toFixed(2).replace(/\.?0+$/, '');
                    div.innerHTML = `<span>${i.name} × ${qtyStr}</span>`;
                    summary.appendChild(div);
                });
            };

            addSection('Lunch', lunch);
            addSection('Dinner', dinner);
        }

        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzSU2DvQ7i7QHrsEnXHVPCAKBsT2EP1mMD-5zFtTip5P9mMXYNUkFbRd0kHUKYRCKf8/exec";

        async function submitOrder(day) {
            const name = document.getElementById('customer-name').value.trim();
            if (!name) return alert('Please enter your name before submitting.');

            const dayContent = document.getElementById(day);
            const items = [];
            dayContent.querySelectorAll('.dish-item').forEach(item => {
                const qty = parseFloat(item.querySelector('.qty-display').textContent) || 0;
                if (qty > 0) {
                    const mealType = item.closest('.meal-section').classList.contains('lunch') ? 'Lunch' : 'Dinner';
                    items.push({ name: item.querySelector('.dish-name').textContent.trim(), quantity: qty, mealType });
                }
            });

            if (items.length === 0) return alert('Please select at least one dish.');

            const loading = document.getElementById('loading-overlay');
            loading.style.display = 'flex';

            try {
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: "POST",
                    mode: "no-cors",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ name, day: day.charAt(0).toUpperCase() + day.slice(1), items })
                });

                const toast = document.getElementById('toast');
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 3000);

                // Reset all quantities
                dayContent.querySelectorAll('.qty-display').forEach(d => d.textContent = '0');
                updateSummary(day);
            } catch (err) {
                alert('Error submitting order. Please try again.');
            } finally {
                loading.style.display = 'none';
            }
        }

        // Password Modal for DB (unchanged)
        (function(){
            const PASSWORD = "admin123";
            const viewBtn = document.getElementById("view-db-link");

            viewBtn.addEventListener('click', function(e){
                e.preventDefault();
                document.getElementById('db-password-modal').style.display = 'block';
            });
        })();

        // Initialize
        document.addEventListener('DOMContentLoaded', initMenu);
    </script>

    <!-- Simple Password Modal -->
    <div id="db-password-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:9999;">
        <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;padding:30px;border-radius:12px;width:90%;max-width:400px;text-align:center;">
            <h3>Enter Password</h3>
            <input type="password" id="db-pass-input" style="width:100%;padding:12px;margin:15px 0;border-radius:8px;border:1px solid #ccc;">
            <div>
                <button onclick="document.getElementById('db-password-modal').style.display='none'" style="padding:10px 20px;margin:5px;background:#ccc;border:none;border-radius:8px;cursor:pointer;">Cancel</button>
                <button onclick="
                    if(document.getElementById('db-pass-input').value==='admin123'){
                        window.open('https://docs.google.com/spreadsheets/d/1E_Um7247eCREoxiXttCCd76xRgFB6nMCf3bzzMrNch0/edit','_blank');
                        document.getElementById('db-password-modal').style.display='none';
                    } else { alert('Incorrect password'); }
                " style="padding:10px 20px;margin:5px;background:#DAA520;color:#8B4513;border:none;border-radius:8px;cursor:pointer;font-weight:bold;">Open Database</button>
            </div>
        </div>
    </div>
</body>
</html>
